pico-8 cartridge // http://www.pico-8.com
version 41
__lua__
-- constants

pi = 3.141592653589793

c = 2.99792458*10^8 -- speed of light
mu = 4.0 * pi * 1.0*10^-7 -- free space def
eps = 1.0 / (c * c * mu)
freq = 1*10^8 -- frequency

ie = 36 -- grids
je = 36


lmda = 1.0 / freq
dx = lmda / 20.0
dy = lmda / 20.0
dt = 1.0 / (c * sqrt(1 / dx^2 + 1 / dy^2))

-- updating coefficients
--ca = 1
--cb = dt / (eps * dx)
--da = 1
--db = dt / (mu * dx)

-- precalculated due to precision limits
ca = 1
cb = 0.26638855932735174
da = 1
db = 1.8769574836942405

-- setup arrays
ez = {}
hx = {}
hy = {}

for i = 0, ie do
  ez[i] = {}
  hx[i] = {}
  hy[i] = {}
  
  for j = 0, je do
    ez[i][j] = 0
    hx[i][j] = 0
    hy[i][j] = 0
  end
end

frame = 1

-- animation loop
function _update()

  frame += 1
  for i = 2, ie do
    for j = 2, je do
      ez[i][j] = ca * ez[i][j] + cb * (hx[i][j - 1] - hx[i][j] + hy[i][j] - hy[i-1][j])
    end
  end
  
  -- generate sine wave
  local w = 2 * pi * frame / 100
--  local x = sin(w / 50)*10 
 -- local y = cos(w / 50)*10 
--  if frame < 50 then
    ez[1][flr(je/2)] = sin(w)*20 
    
    
 -- end
  
  -- update hx
  for i = 2, ie do
    for j = 1, je - 1 do
      hx[i][j] = hx[i][j] + db * (ez[i][j] - ez[i][j + 1])
    end
  end
  
  -- update hy
  for i = 1, ie - 1 do
    for j = 2, je do
      hy[i][j] = hy[i][j] + db * (ez[i + 1][j] - ez[i][j])
    end
  end
 
  -- dampen fields
  for i = 1, ie do
    for j = 1, je do
      ez[i][j] = ez[i][j] * 0.99
      hx[i][j] = hx[i][j] * 0.99
      hy[i][j] = hy[i][j] * 0.99
    end
  end
  
end

function _init()
 _update()
end

r = ie
function _draw()
	cls(0)
	
		for y=2,r do
			for x=2,r do
				z=ez[x][y]
				
				pset(x*3-y/1.4+21,25+y*2-z*2,6)
		end
	end
	
	title()
end


wave_offset = -20
function title()

 str = "fdtd simulation"
 
 if wave_offset > -80 then
  local colors = {1,2,3,11}
  for i = 1, #str do
    local char = str[i]
    
    for k=1,#colors do
    
    local yc = cos(-t() + i/6.0 + k/7.0)*10
    print(char,8+i*8,30+yc+wave_offset,colors[k])
    end
  end
  for i = 1, #str do
    local char = str[i]
    local y = sin(-t() + i/6.0)*2
    printout(char,14+i*7,30+y+wave_offset,10,8)
  end
 end
end


function printout(str,x,y,oc,fc)
 for ix =x-1,x+1 do
  for iy= y-1, y+1 do
   print(str, ix, iy, oc)
  end
 end
 print(str, x, y, fc)
end
__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0102020202020202020202020202020101020202020202020202020202020201010202020202020202020202020202010102020202020202020202020202020101020202020202020202020202020201010202020202020202020202020202010102020202020202020202020202020101020202020202020202020202020201
0102020202020202020202020202020101020202020202020202020202020201010202020202020202020202020202010102020202020202020202020202020101020202020202020202020202020201010202020202020202020202020202010102020202020202020202020202020101020202020202020202020202020201
0102020202020202020202020202020101020202020202020202020202020201010202020202020202020202020202010102020202020202020202020202020101020202020202020202020202020201010202020203020303030302020202010102020202020202020202020202020101020202020202020202020202020201
0102020202020303030202020202020101020202020202020203020202020201010202020202020202020202020202010102020202020203030302020202020101020202020202020202020202020201010202020203020202020302020202010102020202020202020202030202020101020202020302020202030202020201
0102020202020202030302020202020101020202020202020203020202020201010202020202020302020202020202010102020202020303030302020202020101020202030202020302020202020201010202020203020202020302020202010102020202030202020203030202020101020202030302020203030202020201
0102020202020202020302020202020101020202020203030203020202020201010202020202030302020202020202010102020202030202030202020202020101020202030202020303030302020201010202020203020202020302020202010102020203020203020203020202020101020202030202020203020202020201
0102020202020202030302020202020101020202020203020203020202020201010202020202030202020202020202010102020202030303030202020202020101020202030202020302020302020201010202020203020202020302020202010102020303020203020203020202020101020202030202020302020202020201
0102020202020203030202020202020101020202020203030303020202020201010202020202030202020202020202010102020202030303020202020202020101020202030202020302030302020201010202020203020202030302020202010102020202020203030303020202020101020202030202020303030202020201
0102020202020303030303020202020101020202020303030203020202020201010202020203030303020202020202010102020202030203030202020202020101020202030202020303030202020201010202020203020203030303020202010102020302020203030302020202020101020202030202020302030202020201
0102020202020202020202020202020101020202020202020303020202020201010202020203020202030202020202010102020202030202030202020202020101020202030302020202020202020201010202020202020203030302020202010102020302020202020302020202020101020202030202020303030202020201
0102020202020202020202020202020101020202020202020203020202020201010202020203030202030202020202010102020202030303030202020202020101020202020202020202020202020201010202020202020202020202020202010102020302020202030302020202020101020202030302020202020202020201
0102020202020202020202020202020101020202020202020202020202020201010202020202020303020202020202010102020202020303020202020202020101020202020202020202020202020201010202020202020202020202020202010102020202020202020202020202020101020202030202020202020202020201
0102020202020202020202020202020101020202020202020202020202020201010202020202020202020202020202010102020202020202020202020202020101020202020202020202020202020201010202020202020202020202020202010102020202020202020202020202020101020202020202020202020202020201
0102020202020202020202020202020101020202020202020202020202020201010202020202020202020202020202010102020202020202020202020202020101020202020202020202020202020201010202020202020202020202020202010102020202020202020202020202020101020202020202020202020202020201
0102020202020202020202020202020101020202020202020202020202020201010202020202020202020202020202010102020202020202020202020202020101020202020202020202020202020201010202020202020202020202020202010102020202020202020202020202020101020202020202020202020202020201
0102020202020202020202020202020101020202020202020202020202020201010202020202020202020202020202010102020202020202020202020202020101020202020202020202020202020201010202020202020202020202020202010102020202020202020202020202020101020202020202020202020202020201
0102020202020202020202020202020101020202020202020202020202020201010202020202020202020202020202010102020202020202020202020202020101020202020202020202020202020201010202020202020202020202020202010102020202020202020202020202020101020202020202020202020202020201
0102020202020202020202020202020101020202020202020202020202020201010202020202020202020202020202010102020202020202020202020202020101020202020202020202020202020201010202020202020202020202020202010102020202020202020202020202020101020202020202020202020202020201
0102020202020202020202020202020101020202020202020202020202020201010202020202020202020202020202010102020202020202020202020202020101020202020202020202020202020201010202020202020202020202020202010102020202020202020202020202020101020202020202020202020202020201
0102020202020202020202020202020101020202020202020202020202020201010202020202020202020202020202010102020202020202020202020202020101020202020202020202020202020201010202020202020202020202020202010102020202020202020202020202020101020202020202020202020202020201
0102020202020202020202020202020101020202020202020202020202020201010202020202020202020202020202010102020202020202020202020202020101020202020202020202020202020201010202020202020202020202020202010102020202020202020202020202020101020202020202020202020202020201
0102020202020203020202020202020101020202020202030303020202020201010202020202020202020203020202010102020202020202020202020202020101020202020202020202020202020201010202020203020202020202020202010102020202020202020202020202020101020202020202020202020202020201
0102020202020203020202020202020101020202020303030203020202020201010202020202020203030303020202010102020203030303030303030202020101020202020203030302020202020201010202020203020202020202020202010102020203020202020303030202020101020202020202020202020202020201
0102020202020302020202020202020101020202020202020203020202020201010202020202030303020202020202010102020202020202020203030202020101020202020203020203020202020201010202020203020203030302020202010102020203020202020302030302020101020202030302020202030303030301
0102020202020302020202020202020101020202020202020303020202020201010202020202030303030202020202010102020202020202020303030202020101020202020203020303020202020201010202020203030202020302020202010102020203020202020202030302020101020202020302020202030303020201
0102020202020302020202020202020101020202020202020203030202020201010202020202020202030202020202010102020202020202020302030202020101020202020203030303020202020201010202020202030202020302020202010102020203020202020203030202020101020202020302020202030202020201
0102020202020302020202020202020101020202020202020202030202020201010202020202030303030202020202010102020202020202030303030202020101020202020202020203020202020201010202020202030202020302020202010102020203020202020203030202020101020202020302020203030302020201
0102020202020203020202020202020101020202020202020202030202020201010202020202020303020202020202010102020202020202030303020202020101020202020202020203020202020201010202020202030202020302020202010102020203020202020202030202020101020202020302020203030303020201
0102020202020202020202020202020101020202020303030303030202020201010202020202020202020202020202010102020202020203030302020202020101020202020202020203020202020201010202020202030202020302020202010102020203020202020202030202020101020202020302020203030303020201
0102020202020202020202020202020101020202020202020202020202020201010202020202020202020202020202010102020202020203020202020202020101020202020202020202020202020201010202020202030202020302020202010102020202020302030303030202020101020202020302020202020303020201
0102020202020202020202020202020101020202020202020202020202020201010202020202020202020202020202010102020202020202020202020202020101020202020202020202020202020201010202020202020202020202020202010102020202020303020202020202020101020202020302020303030302020201
0102020202020202020202020202020101020202020202020202020202020201010202020202020202020202020202010102020202020202020202020202020101020202020202020202020202020201010202020202020202020202020202010102020202020302020202020202020101020202020202020202020202020201
